import{d as ie,N as ue,h as $,g as U,y as se,ah as de,j as me,A as fe,D as m,o as u,c as K,r as E,k as L,I as _,w as p,m as b,F as P,e as v,M as F,Z as ce,b as I,E as j,a as A,O as pe,aL as ve,aM as ye}from"./framework.URa763XA.js";import{aQ as be,x as Ie,aM as z,aR as S,E as he,M as ke}from"./kliep-tools.es.b9z_Dmbz.js";import{U as ge,D as Z,H as Ce,S as Ve}from"../app.zGwxoYMy.js";import{E as Ke,B as _e,x as Fe,k as Be,J as Te}from"./default-config-j02UPaTJ.5ZvBw-hn.js";import{O as $e,w as Le,a as Pe,Z as we,y as Me,W as Re,z as He,n as Ue}from"./isBoolean-AcbPwlS2.eQ5SRrWp.js";import"./index.UfSCTmkv.js";import"./theme.cz4nT2hu.js";var Ee="[object Map]",Se="[object Set]",Oe=Object.prototype,xe=Oe.hasOwnProperty;function q(o){if(o==null)return!0;if(Be(o)&&(Te(o)||typeof o=="string"||typeof o.splice=="function"||Pe(o)||we(o)||Me(o)))return!o.length;var B=Re(o);if(B==Ee||B==Se)return!o.size;if(He(o))return!Ue(o).length;for(var w in o)if(xe.call(o,w))return!1;return!0}const De={class:"filter"},Ne={class:"filter-main__form mr10"},je={class:"filter-main__btn"},Ae={class:"filter-main__btn--align"},ze=ie({name:"kd-filter",__name:"Filter",props:{filterName:{default:""},filterList:{default:()=>[]},filterCol:{},filterFieldsColon:{type:Boolean,default:!1},filterQueryCache:{type:Boolean,default:!1},filterDefaultBtn:{type:Boolean,default:!0},filterCache:{type:Boolean,default:!0},filterEnableTools:{type:Boolean}},emits:["filterSearchCb","filterResetCb","filterBeforeMount","filterMounted","filterUnmouted"],setup(o,{expose:B,emit:w}){const Q=ve(()=>ye(()=>import("./ToolsBar-dF6teILU.jo-G-n0J.js"),__vite__mapDeps([0,1,2,3,4,5,6,7]))),J=be({},Ke,ue("kd-filter-table",()=>{})),s=o,W={...Ie[30]},X={},Y={},h=$(),O={input:"",select:"",selectMutiple:[],datePicker:""},x=U(()=>s.filterList.filter(l=>$e(l.formItemHidden)?!l.formItemHidden:!(_e(l.formItemHidden)&&l.formItemHidden())).map(l=>(l.key=`${l.formItemLabel}_${l.formItemKey}`,l))),M=l=>{const a={};return l.reduce((r,i)=>{const{formItemKey:d,formItemType:f,disabled:C,formItemInitValue:c,datePickerReallyKeys:y}=i;if(!C&&!q(c)){if(f=="datePicker"&&y){const[V,T]=y.split(",");r[V]=c[0],r[T]=c[1]}r[d]=c}else r[d]=O[f]??"";return r},a),{...a}},k=$(Le(x.value)),t=$(M(k.value)),G=$(!1),ee=U(()=>k.value.length>24/z.md?{alignItems:"center"}:{}),le=U(()=>s.filterCol?s.filterCol:z);se(()=>s.filterList,(l,a)=>{const r={};a==null||a.map(i=>{const{formItemKey:d,formItemType:f,disabled:C}=i;if(C&&(t.value[d]=O[f],f=="datePicker")){const{datePickerReallyKeys:c}=i,[y,V]=c.split(",");t.value[y]="",t.value[V]=""}r[d]=f}),l!=null&&l.some(i=>!r[i==null?void 0:i.formItemKey])&&(t.value=M(s.filterList)),k.value=[...l]},{deep:!0}),de(()=>{const l=S({...t.value});!q(l)&&Z.emit("filterSendInit2Table",{...l}),g("filterBeforeMount")}),me(()=>g("filterMounted")),fe(()=>g("filterUnmouted"));const te=(l="表单项")=>`${l}${s.filterFieldsColon?"：":""}`,ae=l=>[l?{...ke,message:""}:{required:!1}],R=(l="表单项",a)=>{switch(a){case"input":return`请输入${l}`;case"select":return`请选择${l}`;case"datePicker":return`请选择${l}`;default:return`请输入${l}`}},oe=(l,a,r)=>{if(a){const[i,d]=[...a.split(",")];t.value[i]=(l==null?void 0:l[0])??"",t.value[d]=(l==null?void 0:l[1])??"",r.change&&r.change(l)}},D=l=>{l==null||l.resetFields(),g("filterResetCb",l),t.value=M(s.filterList),N(S({...t.value}))},H=()=>{h.value.validate(l=>{if(!l)return!1;const a=S({...t.value});g("filterSearchCb",a),N(a)})},re=l=>{var a;k.value=l,(a=l==null?void 0:l.filter(r=>r.formItemHidden))==null||a.map(r=>{const{formItemKey:i}=r;h.value.resetFields(i)})},N=l=>Z.emit("filterSendQuery2Table",l),g=w;return B({formRef:h,formValue:t,doSearch:H,doReset:D}),(l,a)=>{const r=m("el-input"),i=m("el-option"),d=m("el-select"),f=m("el-date-picker"),C=m("el-form-item"),c=m("el-col"),y=m("el-row"),V=m("el-form"),T=m("el-button");return u(),K("div",De,[E(l.$slots,"filterHeader",{},void 0,!0),L("div",{class:"filter-main",style:pe(ee.value)},[L("div",Ne,[_(V,{ref_key:"formRef",ref:h,model:t.value},{default:p(()=>[_(y,{gutter:b(he)[20]},{default:p(()=>[(u(!0),K(P,null,j(k.value,(e,ne)=>(u(),K(P,null,[e.formItemHidden?v("",!0):(u(),I(c,F({key:0},le.value,{key:`${e.formItemKey}_${ne}`,class:"pb5"}),{default:p(()=>[_(C,{prop:e.formItemKey,label:te(e.formItemLabel),rules:ae(!!e.formItemRequired)},{default:p(()=>[e.formItemType=="input"?(u(),I(r,F({key:0,modelValue:t.value[e.formItemKey],"onUpdate:modelValue":n=>t.value[e.formItemKey]=n,placeholder:R(e.formItemLabel,"input")},{...W,...e},{onKeydown:ce(H,["enter"]),onClick:e==null?void 0:e.click,onBlur:e==null?void 0:e.blur,onInput:e==null?void 0:e.input,onClear:e==null?void 0:e.clear,onChange:e==null?void 0:e.change,onFocus:e==null?void 0:e.focus}),null,16,["modelValue","onUpdate:modelValue","placeholder","onKeydown","onClick","onBlur","onInput","onClear","onChange","onFocus"])):v("",!0),e.formItemType=="select"?(u(),I(d,F({key:1,modelValue:t.value[e.formItemKey],"onUpdate:modelValue":n=>t.value[e.formItemKey]=n,placeholder:R(e.formItemLabel,"select")},{...X,...e},{onChange:e==null?void 0:e.change,onClear:e==null?void 0:e.clear,onBlur:e==null?void 0:e.blur,onFocus:e==null?void 0:e.focus,onVisibleChange:e==null?void 0:e.visibleChange,onRemoveTag:e==null?void 0:e.removeTag,style:{width:"100%"}}),{default:p(()=>[(u(!0),K(P,null,j(e.selectOptions,n=>(u(),I(i,{key:e.selectKeyValueField?n[e.selectKeyValueField.value]:n.value,label:e.selectKeyValueField?typeof e.selectKeyValueField.label=="function"?e.selectKeyValueField.label(n):n[e.selectKeyValueField.label]:n.label,value:e.selectKeyValueField?n[e.selectKeyValueField.value]:n.value},null,8,["label","value"]))),128))]),_:2},1040,["modelValue","onUpdate:modelValue","placeholder","onChange","onClear","onBlur","onFocus","onVisibleChange","onRemoveTag"])):v("",!0),e.formItemType=="datePicker"?(u(),I(f,F({key:2,modelValue:t.value[e.formItemKey],"onUpdate:modelValue":n=>t.value[e.formItemKey]=n,placeholder:R(e.formItemLabel,"datePicker")},{...Y,...e},{onChange:n=>oe(n,e.datePickerReallyKeys,e)}),null,16,["modelValue","onUpdate:modelValue","placeholder","onChange"])):v("",!0),e.formItemType=="slot"?E(l.$slots,`filter${b(Fe)(e.formItemKey)}`,F({key:3,modelValue:{value:t.value[e.formItemKey]},updateModelValue:n=>t.value[e.formItemKey]=n},e),void 0,!0):v("",!0)]),_:2},1032,["prop","label","rules"])]),_:2},1040))],64))),256))]),_:3},8,["gutter"])]),_:3},8,["model"])]),L("div",je,[L("div",Ae,[s.filterDefaultBtn?(u(),K(P,{key:0},[_(T,{type:"primary",icon:b(Ce),loading:G.value,onClick:H},{default:p(()=>[A(" 查询 ")]),_:1},8,["icon","loading"]),_(T,{icon:b(Ve),onClick:a[0]||(a[0]=e=>D(h.value))},{default:p(()=>[A(" 重置 ")]),_:1},8,["icon"])],64)):v("",!0),E(l.$slots,"filterBtn",{},void 0,!0),s.filterEnableTools||b(J).toolsBar?(u(),I(b(Q),{key:1,class:"ml12","bar-setting-tool-tip-content":"搜索项设置","bar-setting-popover-check-all-label":"搜索显示","bar-setting-check-label":"formItemLabel","bar-setting-hide-key":"formItemHidden","bar-setting-no-drag-key":"formItemRequired","bar-setting-check-list":x.value,onDynamicListUpdate:re},null,8,["bar-setting-check-list"])):v("",!0)])])],4)])}}}),Ge=ge(ze,[["__scopeId","data-v-c782f75b"]]);export{Ge as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/chunks/ToolsBar-dF6teILU.jo-G-n0J.js","assets/chunks/kliep-tools.es.b9z_Dmbz.js","assets/chunks/framework.URa763XA.js","assets/chunks/index.UfSCTmkv.js","assets/app.zGwxoYMy.js","assets/chunks/theme.cz4nT2hu.js","assets/chunks/isBoolean-AcbPwlS2.eQ5SRrWp.js","assets/chunks/default-config-j02UPaTJ.5ZvBw-hn.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}